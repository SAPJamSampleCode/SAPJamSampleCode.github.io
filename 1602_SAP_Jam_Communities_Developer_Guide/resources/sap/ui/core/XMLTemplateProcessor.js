/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2014 SAP SE or an SAP affiliate company. 
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global'],function(q){"use strict";function p(t,v,n,c){var b=sap.ui.base.ManagedObject.bindingParser(v,c,true);if(b&&typeof b==="object"){return b}var V=v=b||v;var T=sap.ui.base.DataType.getType(t);if(T){if(T instanceof sap.ui.base.DataType){V=T.parseValue(v)}}else{throw new Error("Property "+n+" has unknown type "+t)}return typeof V==="string"?sap.ui.base.ManagedObject.bindingParser.escape(V):V}function l(x){return x.localName||x.baseName||x.nodeName}var X={};X.loadTemplate=function(t,e){var r=q.sap.getResourceName(t,"."+(e||"view")+".xml");return q.sap.loadResource(r).documentElement};X.parseViewAttributes=function(x,v,s){var a=v.getMetadata().getAllProperties();for(var i=0;i<x.attributes.length;i++){var b=x.attributes[i];if(b.name==='controllerName'){v._controllerName=b.value}else if(b.name==='resourceBundleName'){v._resourceBundleName=b.value}else if(b.name==='resourceBundleUrl'){v._resourceBundleUrl=b.value}else if(b.name==='resourceBundleLocale'){v._resourceBundleLocale=b.value}else if(b.name==='resourceBundleAlias'){v._resourceBundleAlias=b.value}else if(b.name==='class'){v.addStyleClass(b.value)}else if(!s[b.name]&&a[b.name]){s[b.name]=p(a[b.name].type,b.value,b.name,v._oContainingView.oController)}}};X.parseTemplate=function(x,v){var r=[];var c=undefined;var C=v.sViewName||v._sFragmentName;if(!C){var t=v;var L=0;while(++L<1000&&t&&t!==t._oContainingView){t=t._oContainingView}C=t.sViewName}if(v.isSubView()){a(x,true)}else{b(x)}return r;function a(x,R,I){if(x.nodeType===1){var s=l(x);if(x.namespaceURI==="http://www.w3.org/1999/xhtml"||x.namespaceURI==="http://www.w3.org/2000/svg"){r.push("<"+s+" ");var j;for(var i=0;i<x.attributes.length;i++){var k=x.attributes[i];var m=k.value;if(k.name==="id"){m=v._oContainingView.createId(m)}r.push(k.name+"=\""+q.sap.encodeHTML(m)+"\" ")}if(R===true){r.push("data-sap-ui-preserve"+"=\""+v.getId()+"\" ")}r.push(">");b(x);r.push("</"+s+">")}else if(s==="FragmentDefinition"&&x.namespaceURI==="sap.ui.core"){b(x,false,true)}else{var n=e(x);for(var i=0;i<n.length;i++){var o=n[i];if(v.getMetadata().hasAggregation("content")){v.addAggregation("content",o)}else if(v.getMetadata().hasAssociation(("content"))){v.addAssociation("content",o)}r.push(o)}}}else if(x.nodeType===3&&!I){var u=x.textContent||x.text,w=l(x.parentNode);if(u){if(w!="style"){u=q.sap.encodeHTML(u)}r.push(u)}}}function b(x,R,I){var j=x.childNodes;for(var i=0;i<j.length;i++){a(j[i],R,I)}}function f(n,s){var i;var m=sap.ui.getCore().getLoadedLibraries();q.each(m,function(j,k){if(n===k.namespace||n===k.name){i=k.name+"."+((k.tagNames&&k.tagNames[s])||s)}});i=i||n+"."+s;q.sap.require(i);var o=q.sap.getObject(i);if(o){return o}else{q.sap.log.error("Can't find object class '"+i+"' for XML-view","","XMLTemplateProcessor.js")}}function d(n){if(n.namespaceURI==="http://www.w3.org/1999/xhtml"||n.namespaceURI==="http://www.w3.org/2000/svg"){var i=n.attributes['id']?n.attributes['id'].textContent||n.attributes['id'].text:null;return[new sap.ui.core.mvc.XMLView({id:i?v._oContainingView.createId(i):undefined,xmlNode:n,containingView:v._oContainingView})]}else{return e(n)}}function e(n){if(l(n)==="ExtensionPoint"&&n.namespaceURI==="sap.ui.core"){return g(n,v)}else{return h(n)}}function g(n,v){var R=undefined;if(sap.ui.core.CustomizingConfiguration){var j=sap.ui.core.CustomizingConfiguration.getViewExtension(C,n.getAttribute("name"),v);if(j){if(j.className){q.sap.require(j.className);var o=q.sap.getObject(j.className);q.sap.log.info("Customizing: View extension found for extension point '"+n.getAttribute("name")+"' in View '"+C+"': "+j.className+": "+(j.viewName||j.fragmentName));if(j.className==="sap.ui.core.Fragment"){var F=new o({type:j.type,fragmentName:j.fragmentName,containingView:v});R=(q.isArray(F)?F:[F])}else if(j.className==="sap.ui.core.mvc.View"){var v=sap.ui.view({type:j.type,viewName:j.viewName});R=[v]}else{q.sap.log.warning("Customizing: Unknown extension className configured (and ignored) in Component.js for extension point '"+n.getAttribute("name")+"' in View '"+C+"': "+j.className)}}else{q.sap.log.warning("Customizing: no extension className configured in Component.js for extension point '"+n.getAttribute("name")+"' in View '"+C+"': "+j.className)}}else{q.sap.log.debug("Customizing: no View extension found for ExtensionPoint '"+n.getAttribute("name")+"' in View '"+C+"'.")}}if(!R){R=[];var k=n.childNodes;for(var i=0;i<k.length;i++){var m=k[i];if(m.nodeType===1){R=q.merge(R,d(m))}}}return R||[]}function h(n){var j=n.namespaceURI,o=f(j,l(n)),s={},S="",k=[],O;if(!o){return[]}var m=o.getMetadata();var J=m.getJSONKeys();for(var i=0;i<n.attributes.length;i++){var u=n.attributes[i];var N=u.name;var V=u.value;var I=J[N];if(N==="id"){s[N]=v._oContainingView.createId(V);O=V}else if(N==="class"){S+=V}else if(N==="viewName"){s[N]=V}else if(N==="fragmentName"){s[N]=V;s['containingView']=v._oContainingView}else if(N==="binding"){var B=sap.ui.base.ManagedObject.bindingParser(V,v._oContainingView.oController);s.objectBindings=s.objectBindings||{};s.objectBindings[B.model||undefined]=B}else if(N.indexOf(":")>-1){if(u.namespaceURI==="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"){var w=l(u);k.push(new sap.ui.core.CustomData({key:w,value:p("any",V,w,v._oContainingView.oController)}))}else if(N.indexOf("xmlns:")!==0){q.sap.log.warning(v+": XMLView parser encountered and ignored attribute '"+N+"' (value: '"+V+"') with unknown namespace")}}else if(I&&I._iKind===0){s[N]=p(I.type,V,N,v._oContainingView.oController)}else if(I&&I._iKind===1&&I.altTypes){s[N]=p(I.altTypes[0],V,N,v._oContainingView.oController)}else if(I&&I._iKind===2){var B=sap.ui.base.ManagedObject.bindingParser(V,v._oContainingView.oController);if(B){s[N]=B}else{q.sap.log.error(v+": aggregations with cardinality 0..n only allow binding paths as attribute value (wrong value: "+N+"='"+V+"')")}}else if(I&&I._iKind===3){s[N]=v._oContainingView.createId(V)}else if(I&&I._iKind===4){s[N]=q.map(V.split(/[\s,]+/g),function(G){return G?v._oContainingView.createId(G):null})}else if(I&&I._iKind===5){var E=v._oContainingView.oController[V];if(typeof(E)!=="function"){q.sap.log.warning(v+": event handler function \""+V+"\" is not a function or does not exist in the controller.")}if(E){E["_sapui_handlerName"]=V;s[N]=[E,v._oContainingView.oController]}}else if(N!=="xmlns"){q.sap.log.warning(v+": XMLTemplateProcessor encountered and ignored unknown attribute '"+N+"' (value: '"+V+"')")}}if(k.length>0){s.customData=k}function y(n,A,z){var G,H;for(G=n.firstChild;G;G=G.nextSibling){if(G.nodeType===1){H=G.namespaceURI===j&&z&&z[l(G)];if(H){y(G,H)}else if(A){var K=d(G);for(var i=0;i<K.length;i++){var M=K[i];var P=A._sName;if(A.multiple){if(!s[P]){s[P]=[]}if(typeof s[P].path==="string"){s[P].template=M}else{s[P].push(M)}}else{s[P]=M}}}else if(l(n)!=="FragmentDefinition"||n.namespaceURI!=="sap.ui.core"){throw new Error("Cannot add direct child without default aggregation defined for control "+m.getElementName())}}else if(G.nodeType===3){if(q.trim(G.textContent||G.text)){throw new Error("Cannot add text nodes as direct child of an aggregation. For adding text to an aggregation, a surrounding html tag is needed")}}}}var A=m.getDefaultAggregation();var z=m.getAllAggregations();y(n,A,z);if(sap.ui.core.CustomizingConfiguration&&O){var D=sap.ui.core.CustomizingConfiguration.getCustomProperties(C,O,v);if(D){s=q.extend(s,D);q.sap.log.info("Customizing: Control modification found for Control '"+O+"' in View '"+C+"': "+JSON.stringify(D))}else{if(document.location.search.indexOf("sap-ui-xx-debugCustomizing")>-1){q.sap.log.debug("Customizing: no Control modification found for Control '"+O+"' in View '"+C+"'.")}}}var F;if(sap.ui.core.mvc.View.prototype.isPrototypeOf(o.prototype)&&typeof o._sType==="string"){F=sap.ui.view(s,undefined,o._sType)}else{F=new o(s)}if(S&&F.addStyleClass){F.addStyleClass(S)}if(!F){F=[]}else if(!q.isArray(F)){F=[F]}return F}};return X},true);
